
<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Basic Page Needs
  �������������������������������������������������� -->
  <meta charset="utf-8">
  <title>K Nearest Neighbors</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  �������������������������������������������������� -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  �������������������������������������������������� -->
 <link href='https://fonts.googleapis.com/css?family=Raleway:400,300,600'  rel='stylesheet' type='text/css'>

  <!-- CSS
  �������������������������������������������������� -->
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/custom.css">

  <!-- Scripts
  �������������������������������������������������� -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
  <script src="js/site.js"></script>

  <!-- Favicon
  �������������������������������������������������� -->
  <link rel="icon" type="image/png" href="dist/images/favicon.png">





<style>

</style>






</head>

<body class="code-snippets-visible">

  <!-- Primary Page Layout
  �������������������������������������������������� -->
  <div class="container">


    <div class="navbar-spacer"></div>
   <nav class="navbar">
      <div class="container">
        <ul class="navbar-list">
          <li class="navbar-item"><a class="navbar-link" href="#intro">Home</a></li>
          <li class="navbar-item">
            <a class="navbar-link" href="#" data-popover="#codeNavPopover">MLB API</a>
            <div id="codeNavPopover" class="popover">
              <ul class="popover-list">
                <li class="popover-item">
                  <a class="popover-link" href="#intro">Intro</a>
                </li>
                <li class="popover-item">
                  <a class="popover-link" href="#json">JSON Response</a>
                </li>
                <li class="popover-item">
                  <a class="popover-link" href="#client">Node Client</a>
                </li>
              </ul>
            </div>
          </li>
          <li class="navbar-item"><a class="navbar-link" href="neuralnetwork.html">Artificial Neural Network</a></li>
        </ul>
      </div>
    </nav>

 
         <div><img src="mlb pics/knn.png" width="100%" height="5%"/></div>
          <div class="docs-section"  id="intro">
              <p> </br>I'm going to use basketball statistics for this particular application.  Say you want to predict how much Paul George is going to score on a given night, and you have all previous games statistical data.  In the dataset below, Paul George's "Points" will be the unknown.  </br></p>
	</div>
	<table class="u-full-width">
  <thead>
    <tr>
      <th>Name</th>
      <th>Average Points</th>
      <th>Variance Points</th>
      <th>Opponent Average Points</th>
      <th>Points</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Anthony Davis</td>
      <td>55.1316</td>
      <td>321.98</td>
      <td>203.155</td>
	<td>67</td>
    </tr>
    <tr>
      <td>DeMarcus Cousins</td>
      <td>48.1</td>
      <td>139.74</td>
      <td>202.22</td>
	<td>62.4</td>
    </tr>
	      <tr>
      <td>Russell Westbrook</td>
      <td>58.4</td>
      <td>133.23</td>
      <td>209.55</td>
	<td>58.4</td>
    </tr>
	      <tr>
      <td>Blake Griffin</td>
      <td>40.095</td>
      <td>55.81</td>
      <td>209.71</td>
	<td>53.7</td>
    </tr>
	  	      <tr>
      <td>Serge Ibaka</td>
      <td>26.555</td>
      <td>84.34</td>
      <td>191.70</td>
	<td>48.4</td>
    </tr>
	  	  	      <tr>
      <td>Rudy Gay</td>
      <td>33.1278</td>
      <td>97.208</td>
      <td>202.22</td>
	<td>41.8</td>
    </tr>
	  	  	  	      <tr>
      <td>Kristaps Porzingis</td>
      <td>34.5947</td>
      <td>61.93</td>
      <td>204.37</td>
	<td>39.8</td>
    </tr>
	  	  	  	  	      <tr>
      <td>Paul George</td>
      <td>36.05</td>
      <td>52.6875</td>
      <td>185.019</td>
	<td>//solve this35.9</td>
    </tr>
	  
  </tbody>
</table>

          <div class="docs-section" style="padding-top: 6rem;padding-bottom: 3rem;" id="intro">
              <p> What the nearest neighbors algorithm doesn't is finds the distance between all the different input variables from each other.  The input variables in this case will be average points, variance points, and opponents average points. The output is the actual number of points each player scored on a given night.  We want to find the K closest distances to Paul George's statistics.  </br></p>
	
	 <div class="docs-section" style="padding-top: 6rem;padding-bottom: 3rem;" id="distance">
		 <h3>Distance</h3>
              <div><img src="mlb pics/distances.png" width="35%" height="35%"/></div>
		 <p>For this example I'm going to use Euclidean distance.  To compute the distance between Paul George and Kristaps Porzingis we would do:</br>
square_root((36.05-34.5947)^2 + (52.6875-61.93)^2+(185.019-204.37)^2) </br> You would repeat this computation for all rows of data (i.e. Paul George distance to Anthony Davis, Paul George distance to DeMarcus Cousins, etc.) , and the nearest K neighbors would be the K players with the smallest Euclidean distance to Paul George.</p>






<div><h5>Standardize data</h5><p>The biggest issue with this computation is the data isn't standardized.  For example the distance between point variance and point average is likely going to be a lot higher, causing variance to have a lot higher weight in the distance computation.  Looking at the Kristaps Porzingis vs Paul George example, the difference between average points (36.05-34.5947)=1.4553 and average variance (52.6875-61.93)=-9.2425 is a lot further off, especially after you square each number in the Euclidean formula.  This will lead to variance having a lot higher influence in the overall formula.  </br></br> To counter this, we can standardize the variables between 0 and 1:</br> 
<img src="mlb pics/distancecomputation.png" width="20%" height="20%"/></br>Where X is a given variable for a player, and Min and Max are the minimum and maximum amounts of that particular variable within the dataset.  </br>Example:
</br>Average points max=58.4 (Russell Westbrook)</br>
Average points min=26.555 (Serge Ibaka)</br>  Paul George's place average points in this standardization computation would be</br>
(36.05-26.555)/(58.4-26.555)=0.298</br>
This is a very basic standardization technique, but it will work for this example.  Extreme outliers can greatly skew this computation so it is not ideal much of the time.  
</p>
<h5>C# Example</h5>
<p>
Say we have a list named "tonight" of players playing tonight.  We do not know how many points they will score.  We can compute another list 
	titled "previous" of players who played on a previous night.  We know how many points players on previous nights scored.  We also have 
	average, variance, and opponent average for each player in both lists.  To compute a list of distances we can do the following: 

</p>
<pre><code>
Dictionary<string, List<double>> player_Alldistances = new Dictionary<string, List<double>>();
foreach(player p in tonight){
    List<double> distances = new List<double>();
    foreach(player p2 in previous){
           distances.Add(calculateDistance(p, p2));
    }
    player_Alldistances.Add(p.Name, distances);          
}
public static double calculateDistance(player p, player p2)
{
    double mean = Math.Pow((p.meanPoints - meanMin) / (meanMax - meanMin) -
        (p2.meanPoints - meanMin) / (meanMax - meanMin), 2);

    double variationPoints = Math.Pow((p.variancePoints - variancePointsMin) / (variancePointsMax - variancePointsMin) -
        (p2.deviationPoints - variancePointsMin) / (variancePointsMax - variancePointsMin), 2);

    double opptTotalPointsAverage = Math.Pow((p.OpptTotalPointsAverage - OpptTotalPointsAverageMin) / (OpptTotalPointsAverageMax - OpptTotalPointsAverageMin) -
        (p2.OpptTotalPointsAverage - OpptTotalPointsAverageMin) / (OpptTotalPointsAverageMax - OpptTotalPointsAverageMin), 2);

    double distsum = mean + variationPoints + opptTotalPointsAverage;
    double distance= System.Math.Sqrt(Math.Abs(distance));

    return distance;
}

			</code></pre></p></div>

<div>
Now we have a list of distances for each player compared to players who played on previous nights.  This is where "K" comes in.  There is some theory on how to choose K, but I'll just take a percentile
of the length of the list to compute a K.  For example, say I had 20,000 distances for a given player.  I'll take the closest 2% of the list of distances, and computer their average.   From here, I'll take the output value (points on given night) of the top 2% of the nearest neighebors, average them,
and this will be my output.  Example:</div>
<pre><code>
foreach(KeyValuePair<string, List<double>> entry in player_Alldistances)
{
    //get index of top 2%
    int twoPercent = entry.Value.Count * .02;
    entry.Value=entry.Value.OrderByAscending(x => x).ToList();
    double total = 0;
    for(int i = 0;i(less than)twoPercent;i++){
        total+=entry.Value.ElementAt(i);
    }
    double average = total / twoPercent;
    Console.Write(entry.Key+" guessed value="+average);
}

			</code></pre>


	  <div class="docs-section" style={intro} id="client">





              <div class="docs-section" style={intro} id="client">
                  <h5 style={{marginBottom: 0}} >Sample NodeJs Client:</h5>
		  	<pre><code></code></pre>
              </div>








<!-- End Document
  �������������������������������������������������� -->
</body>
</html>
